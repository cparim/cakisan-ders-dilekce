<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Çakışan Ders Dilekçe Formu</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; max-width: 820px; margin: 0 auto; }
    label { font-weight: 600; display:block; margin-top: 12px; }
    input, textarea { width: 100%; padding: 10px; box-sizing: border-box; margin-top: 6px; }
    .btn { padding: 10px 12px; cursor: pointer; }
    .btn-secondary { background:#eee; border:1px solid #ccc; }
    .btn-danger { background:#ffecec; border:1px solid #ffb3b3; }
    .card { border:1px solid #ddd; padding: 12px; border-radius: 10px; margin-top: 12px; }
    .small { font-size: 12px; color:#666; }
    .grid2 { display:grid; grid-template-columns: 1fr 260px; gap: 12px; }
    .grid2 label { margin-top: 0; }
    .ders-header { font-weight: 700; margin-bottom: 6px; }
    .ders-block { border:1px solid #e3e3e3; border-radius: 10px; overflow:hidden; margin-top: 10px; }
    .ders-block .row { display:grid; grid-template-columns: 1fr 260px; gap: 0; }
    .ders-block .cell { padding: 10px; border-top:1px solid #eee; }
    .ders-block .row:first-child .cell { border-top:none; }
    .ders-block .cell.right { border-left:1px solid #eee; }
    .ders-block .title { font-size: 12px; color:#666; margin-bottom: 6px; }
    .ders-actions { display:flex; justify-content:flex-end; padding: 8px 10px; border-top:1px solid #eee; background:#fafafa; }
    .inline { display:flex; gap:10px; align-items:flex-end; flex-wrap: wrap; }
    .inline > div { flex:1; min-width: 220px; }
  </style>
</head>
<body>

  <h2>Çakışan Ders Mazeret Dilekçesi</h2>
  <p class="small">Formu doldurup gönderince yeni sekmede Word dilekçeniz indirilecektir.</p>

  <form id="frm"
        method="POST"
        action="https://script.google.com/macros/s/AKfycbxwCeg4XdC9vfadjA-tt5WNksXNQwQ7FmUiJQFrxpRCzkDfg3JKDo7l6SmVD6CbB-AWCA/exec"
        target="_blank">

    <label>Ad</label>
    <input type="text" name="ad" id="ad" required>

    <label>Soyad</label>
    <input type="text" name="soyad" id="soyad" required>

    <label>Öğrenci No</label>
    <input type="text" name="ogrno" id="ogrno" required>

    <label>Mail Kullanıcı Adı (örn: abc123)</label>
    <input type="text" name="mail" id="mail">

    <label>Telefon</label>
    <input type="text" name="telefon" id="telefon">

    <label>Bölüm</label>
    <input type="text" name="bolum" id="bolum">

    <label>Açıklama</label>
    <textarea name="aciklama" id="aciklama" rows="4"></textarea>

    <!-- Ders blokları -->
    <div class="card">
      <div class="ders-header">Dersler</div>
      <div class="small">“Ders Ekle” dediğinizde aşağıdaki bilgiler 2 satırlı bir blok olarak listeye eklenecek.</div>

      <div class="card" style="margin-top:12px;">
        <div class="inline">
          <div>
            <label style="margin-top:0;">Alınan Dersin Adı ve Kodu</label>
            <input type="text" id="alinan_ad_kod" placeholder="Örn: FIZ1001 Fizik I">
          </div>
          <div>
            <label style="margin-top:0;">Tarih / Saat</label>
            <input type="text" id="alinan_tarih_saat" placeholder="Örn: 12.02.2026 10:00">
          </div>
        </div>

        <div class="inline">
          <div>
            <label>Çakışan Ders Adı ve Kodu</label>
            <input type="text" id="cakisan_ad_kod" placeholder="Örn: MAT1002 Matematik II">
          </div>
          <div>
            <label>Tarih / Saat</label>
            <input type="text" id="cakisan_tarih_saat" placeholder="Örn: 12.02.2026 10:00">
          </div>
        </div>

        <div style="margin-top:10px;">
          <button type="button" class="btn btn-secondary" onclick="dersBlokEkle()">Ders Ekle</button>
        </div>
      </div>

      <div id="dersListe" class="small" style="margin-top:10px;">
        Henüz ders eklenmedi.
      </div>
    </div>

    <!-- Apps Script bunu JSON olarak okuyacak -->
    <input type="hidden" name="dersler_json" id="dersler_json" value="[]">

    <div style="margin-top:16px;">
      <button class="btn" type="submit">Dilekçe Oluştur</button>
    </div>
  </form>

<script>
  // Artık dersler: blok objeleri
  // { alinanAdKod, alinanTarihSaat, cakisanAdKod, cakisanTarihSaat }
  const dersBloklari = [];

  function dersBlokEkle() {
    const alinanAdKod = document.getElementById("alinan_ad_kod").value.trim();
    const alinanTarihSaat = document.getElementById("alinan_tarih_saat").value.trim();
    const cakisanAdKod = document.getElementById("cakisan_ad_kod").value.trim();
    const cakisanTarihSaat = document.getElementById("cakisan_tarih_saat").value.trim();

    if (!alinanAdKod || !cakisanAdKod) {
      alert("En azından 'Alınan Dersin Adı ve Kodu' ve 'Çakışan Ders Adı ve Kodu' dolu olmalı.");
      return;
    }

    dersBloklari.push({
      alinanAdKod,
      alinanTarihSaat,
      cakisanAdKod,
      cakisanTarihSaat
    });

    // temizle
    document.getElementById("alinan_ad_kod").value = "";
    document.getElementById("alinan_tarih_saat").value = "";
    document.getElementById("cakisan_ad_kod").value = "";
    document.getElementById("cakisan_tarih_saat").value = "";

    renderDersBloklari();
  }

  function dersBlokSil(i) {
    dersBloklari.splice(i, 1);
    renderDersBloklari();
  }

  function renderDersBloklari() {
    const el = document.getElementById("dersListe");
    if (dersBloklari.length === 0) {
      el.innerHTML = "Henüz ders eklenmedi.";
      return;
    }

    const blocks = dersBloklari.map((b, i) => `
      <div class="ders-block">
        <div class="row">
          <div class="cell">
            <div class="title">Alınan Dersin Adı ve Kodu</div>
            <div>${escapeHtml(b.alinanAdKod)}</div>
          </div>
          <div class="cell right">
            <div class="title">Tarih / Saat</div>
            <div>${escapeHtml(b.alinanTarihSaat || "-")}</div>
          </div>
        </div>
        <div class="row">
          <div class="cell">
            <div class="title">Çakışan Ders Adı ve Kodu</div>
            <div>${escapeHtml(b.cakisanAdKod)}</div>
          </div>
          <div class="cell right">
            <div class="title">Tarih / Saat</div>
            <div>${escapeHtml(b.cakisanTarihSaat || "-")}</div>
          </div>
        </div>
        <div class="ders-actions">
          <button type="button" class="btn btn-danger" onclick="dersBlokSil(${i})">Bu Bloğu Sil</button>
        </div>
      </div>
    `).join("");

    el.innerHTML = blocks;
  }

  function escapeHtml(s) {
    return String(s)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#39;");
  }

  // Submitten hemen önce dersler_json doldur
  document.getElementById("frm").addEventListener("submit", function(e){
    document.getElementById("dersler_json").value = JSON.stringify(dersBloklari);

    if (dersBloklari.length === 0) {
      const ok = confirm("Hiç ders eklemediniz. Yine de devam edilsin mi?");
      if (!ok) e.preventDefault();
    }
  });

  renderDersBloklari();
</script>

</body>
</html>
